! function() {
    const e = document,
        t = e.documentElement,
        n = e.body,
        i = e.getElementById("lights-toggle"),
        s = window.sr = ScrollReveal();

    t.classList.remove("no-js"), t.classList.add("js"), window.addEventListener("load", function() {
        n.classList.add("is-loaded")
    }), n.classList.contains("has-animations") && window.addEventListener("load", function() {
        s.reveal(".feature", {
            duration: 600,
            distance: "20px",
            easing: "cubic-bezier(0.215, 0.61, 0.355, 1)",
            origin: "right",
            viewFactor: .2
        })
    }), i && (window.addEventListener("load", a), i.addEventListener("change", a))
}();

const themeToggle = document.getElementById('theme-toggle');
const sunIcon = document.getElementById('sun-icon');
const moonIcon = document.getElementById('moon-icon');
const systemIcon = document.getElementById('system-icon');

const updateThemeIcon = (theme) => {
  sunIcon.classList.add('hidden');
  moonIcon.classList.add('hidden');
  systemIcon.classList.add('hidden');
  if (theme === 'light') {
    sunIcon.classList.remove('hidden');
  } else if (theme === 'dark') {
    moonIcon.classList.remove('hidden');
  } else {
    systemIcon.classList.remove('hidden');
  }
};

themeToggle.addEventListener('click', () => {
  let theme = localStorage.getItem('novaTheme') || 'system';
  if (theme === 'light') {
    theme = 'dark';
  } else if (theme === 'dark') {
    theme = 'system';
  } else {
    theme = 'light';
  }       
  updateThemeIcon(theme);
  if (theme === 'system') {
    localStorage.removeItem('novaTheme');
    theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  } else {
    localStorage.setItem('novaTheme', theme);
  }
  document.body.classList.toggle('lights-off', theme === 'dark');

});

// Initialize theme on page load
const initTheme = () => {
  let theme = localStorage.getItem('novaTheme') || 'system';
  updateThemeIcon(theme);
  if (theme === 'system') {
    theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }
  document.body.classList.toggle('lights-off', theme === 'dark');
};

// Listen for system theme changes
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
  if (!localStorage.getItem('novaTheme')) {
    const newTheme = e.matches ? 'dark' : 'light';
    document.body.classList.toggle('lights-off', newTheme === 'dark');       
  }
});

initTheme();